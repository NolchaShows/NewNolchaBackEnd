databases:
  - name: new-nolcha-postgres
    # Render no longer allows legacy Postgres plans (like `starter`) for new DBs.
    # Pick a current Postgres plan (adjust as needed in Render).
    plan: basic-256mb
    diskSizeGB: 5

services:
  - type: web
    name: new-nolcha-strapi
    runtime: node
    plan: starter
    buildCommand: npm ci && npm run build
    startCommand: npm run start
    healthCheckPath: /admin
    disk:
      name: strapi-uploads
      mountPath: /opt/render/project/src/public/uploads
      sizeGB: 5
    envVars:
      - key: NODE_ENV
        value: production
      - key: HOST
        value: 0.0.0.0
      - key: PROXY
        value: "true"

      - key: DATABASE_CLIENT
        value: postgres
      - key: DATABASE_URL
        fromDatabase:
          name: new-nolcha-postgres
          property: connectionString
      - key: DATABASE_SSL
        value: "true"
      - key: DATABASE_SSL_REJECT_UNAUTHORIZED
        value: "false"

      # Set this to your Render URL or custom domain, e.g. https://your-service.onrender.com
      - key: PUBLIC_URL
        sync: false

      # GraphQL (optional; turn on only when needed for schema/codegen)
      - key: GRAPHQL_LANDING_PAGE
        value: "false"
      - key: GRAPHQL_INTROSPECTION
        value: "false"
      # Safety/perf limits (tune as needed)
      - key: GRAPHQL_DEPTH_LIMIT
        value: "7"
      - key: GRAPHQL_AMOUNT_LIMIT
        value: "50"

      # Cloudflare R2 (S3-compatible) for Strapi uploads
      - key: R2_ENDPOINT
        sync: false
      - key: R2_BUCKET
        sync: false
      - key: R2_ACCESS_KEY_ID
        sync: false
      - key: R2_SECRET_ACCESS_KEY
        sync: false
      - key: R2_REGION
        value: auto
      # Optional: if you expose the bucket via a custom domain/CDN, set this
      - key: R2_PUBLIC_URL
        sync: false
      # Optional: store uploads under a folder prefix in the bucket
      - key: R2_ROOT_PATH
        value: uploads

      # Strapi secrets (generate securely in Render)
      - key: APP_KEYS
        generateValue: true
      - key: API_TOKEN_SALT
        generateValue: true
      - key: ADMIN_JWT_SECRET
        generateValue: true
      - key: TRANSFER_TOKEN_SALT
        generateValue: true
      - key: ENCRYPTION_KEY
        generateValue: true
      - key: JWT_SECRET
        generateValue: true

